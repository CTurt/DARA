include $(DEVKITARM)/ds_rules

OBJDUMP	:=	$(PREFIX)objdump

#arm9-disassembled.s: arm9.bin
#	$(OBJDUMP) -D -b binary -m arm arm9.bin > arm9-disassembled.s

all: FIFA07.sav FIFA08.sav

FIFA07.sav: source/*.s
	$(CC) -nostartfiles -nostdlib source/*.s -o FIFA07.elf -Ttext=0x20021A32
	$(OBJCOPY) -O binary FIFA07.elf arm9.bin
	@rm -f FIFA07.elf
	
	$(CC) -nostartfiles -nostdlib structure/save.s -Wa,--defsym,FIFA07=1 -o FIFA07.elf -Ttext=0x20021A32
	$(OBJCOPY) -O binary FIFA07.elf $@
	@rm -f FIFA07.elf
	@rm -f arm9.bin
	
	../CRCFix/CRCFix $@ -f

FIFA08.sav: source/*.s
	$(CC) -nostartfiles -nostdlib source/*.s -o FIFA08.elf -Ttext=0x200228cf
	$(OBJCOPY) -O binary FIFA08.elf arm9.bin
	@rm -f FIFA08.elf
	
	$(CC) -nostartfiles -nostdlib structure/save.s -Wa,--defsym,FIFA08=1 -o FIFA08.elf -Ttext=0x200228cf
	$(OBJCOPY) -O binary FIFA08.elf $@
	@rm -f FIFA08.elf
	@rm -f arm9.bin
	
	../CRCFix/CRCFix $@ -f
